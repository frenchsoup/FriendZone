<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FriendZone Fantasy Football League</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Keeper cost calculation
    const calculateKeeperCost = (draftCost, tag) => {
      if (draftCost === 0) return 0;
      if (tag) return draftCost;
      return (draftCost * 1.1) + 5;
    };

    // Main App component
    const App = () => {
      const [currentTab, setCurrentTab] = React.useState('home');
      const [adminPassword, setAdminPassword] = React.useState('');
      const [isAdminAuthenticated, setIsAdminAuthenticated] = React.useState(false);
      const [keepers, setKeepers] = React.useState({ 2022: [], 2023: [], 2024: [], 2025: [] });
      const [prizes, setPrizes] = React.useState({ 2023: { survivor: [], weeklyHighScores: [] }, 2024: { survivor: [], weeklyHighScores: [] }, 2025: { survivor: [], weeklyHighScores: [] } });
      const [rules, setRules] = React.useState({});
      const [payouts, setPayouts] = React.useState([]);
      const [selectedYear, setSelectedYear] = React.useState('2024');

      // Hardcoded password (replace with environment variable in production)
      const ADMIN_PASSWORD = 'friendzone2025';

      // Fetch data on mount
      React.useEffect(() => {
        const fetchData = async () => {
          const files = [
            { path: '/data/rules.json', setter: setRules, default: {} },
            { path: '/data/payouts.json', setter: setPayouts, default: [] },
            { path: '/data/keepers_2022.json', setter: (data) => setKeepers(prev => ({ ...prev, 2022: data })), default: [] },
            { path: '/data/keepers_2023.json', setter: (data) => setKeepers(prev => ({ ...prev, 2023: data })), default: [] },
            { path: '/data/keepers_2024.json', setter: (data) => setKeepers(prev => ({ ...prev, 2024: data })), default: [] },
            { path: '/data/keepers_2025.json', setter: (data) => setKeepers(prev => ({ ...prev, 2025: data })), default: [] },
            { path: '/data/prizes_2023.json', setter: (data) => setPrizes(prev => ({ ...prev, 2023: data })), default: { survivor: [], weeklyHighScores: [] } },
            { path: '/data/prizes_2024.json', setter: (data) => setPrizes(prev => ({ ...prev, 2024: data })), default: { survivor: [], weeklyHighScores: [] } },
            { path: '/data/prizes_2025.json', setter: (data) => setPrizes(prev => ({ ...prev, 2025: data })), default: { survivor: [], weeklyHighScores: [] } }
          ];

          for (const file of files) {
            try {
              const res = await fetch(file.path);
              if (res.ok) {
                const data = await res.json();
                file.setter(data);
              } else {
                file.setter(file.default);
                console.warn(`Failed to load ${file.path}. Using default value.`);
              }
            } catch (err) {
              file.setter(file.default);
              console.warn(`Error fetching ${file.path}:`, err);
            }
          }
        };
        fetchData();
      }, []);

      // Handle admin login
      const handleAdminLogin = (e) => {
        e.preventDefault();
        if (adminPassword === ADMIN_PASSWORD) {
          setIsAdminAuthenticated(true);
        } else {
          alert('Incorrect password');
        }
      };

      // Handle adding a new keeper
      const handleAddKeeper = (e) => {
        e.preventDefault();
        const team = e.target.team.value;
        const keeper1 = e.target.keeper1.value;
        const draftCost1 = parseFloat(e.target.draftCost1.value) || 0;
        const tag1 = e.target.tag1.checked;
        const cost1 = calculateKeeperCost(draftCost1, tag1);
        const keeper2 = e.target.keeper2.value;
        const draftCost2 = parseFloat(e.target.draftCost2.value) || 0;
        const tag2 = e.target.tag2.checked;
        const cost2 = calculateKeeperCost(draftCost2, tag2);
        const remaining = 200 - (cost1 + cost2);
        if (remaining < 0) {
          alert('Total keeper cost exceeds $200 budget.');
          return;
        }
        if (keepers[2025].some(k => k.team === team)) {
          alert('Team already has keepers for 2025.');
          return;
        }
        const newKeeper = { team, keeper1, draftCost1, tag1, cost1, keeper2, draftCost2, tag2, cost2, remaining, paid: "y" };
        setKeepers({ ...keepers, 2025: [...keepers[2025], newKeeper] });
        e.target.reset();
        // TODO: Call Netlify function to update keepers_2025.json
      };

      // Handle adding a new weekly high score
      const handleAddWeeklyScore = (e) => {
        e.preventDefault();
        const week = parseInt(e.target.week.value);
        const team = e.target.team.value;
        const total = parseFloat(e.target.total.value);
        if (week < 1 || week > 14) {
          alert('Week must be between 1 and 14.');
          return;
        }
        if (prizes[2025].weeklyHighScores.some(score => score.week === week)) {
          alert('Week already exists for 2025 Weekly High Scores.');
          return;
        }
        const newScore = { week, team, total };
        setPrizes({
          ...prizes,
          2025: {
            ...prizes[2025],
            weeklyHighScores: [...prizes[2025].weeklyHighScores, newScore].sort((a, b) => a.week - b.week)
          }
        });
        e.target.reset();
        // TODO: Call Netlify function to update prizes_2025.json
      };

      // Handle adding a new survivor entry
      const handleAddSurvivor = (e) => {
        e.preventDefault();
        const week = parseInt(e.target.week.value) || 0;
        const type = e.target.type.value;
        const team = e.target.team.value;
        if (type === 'eliminated' && (week < 1 || week > 12)) {
          alert('Week must be between 1 and 12 for eliminations.');
          return;
        }
        if (prizes[2025].survivor.some(entry => entry.week === week || (entry.winner && type === 'winner'))) {
          alert('Week or Winner already exists for 2025 Survivor.');
          return;
        }
        const newEntry = type === 'winner' ? { winner: team } : { week, eliminated: team };
        setPrizes({
          ...prizes,
          2025: {
            ...prizes[2025],
            survivor: [...prizes[2025].survivor, newEntry].sort((a, b) => (a.week || 999) - (b.week || 999))
          }
        });
        e.target.reset();
        // TODO: Call Netlify function to update prizes_2025.json
      };

      return (
        <div className="min-h-screen bg-gray-100 font-sans">
          <nav className="bg-blue-800 text-white p-4 shadow-md">
            <div className="container mx-auto flex justify-between items-center">
              <h1 className="text-2xl font-bold">FriendZone Fantasy Football</h1>
              <ul className="flex space-x-6">
                <li><button onClick={() => setCurrentTab('home')} className="hover:underline focus:outline-none">Home</button></li>
                <li><button onClick={() => setCurrentTab('rules')} className="hover:underline focus:outline-none">Rules</button></li>
                <li><button onClick={() => setCurrentTab('payouts')} className="hover:underline focus:outline-none">Payouts</button></li>
                <li><button onClick={() => setCurrentTab('keepers')} className="hover:underline focus:outline-none">Keepers</button></li>
                <li><button onClick={() => setCurrentTab('prizes')} className="hover:underline focus:outline-none">Prizes</button></li>
                <li><button onClick={() => setCurrentTab('admin')} className="hover:underline focus:outline-none">Admin</button></li>
              </ul>
            </div>
          </nav>
          <main className="container mx-auto p-6">
            {currentTab === 'home' && (
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-3xl font-bold text-gray-800 mb-4">Welcome to FriendZone Fantasy Football</h2>
                <p className="text-lg text-gray-600">Your longtime fantasy football league, now online! Explore rules, payouts, keepers, and weekly prizes for the 2025 season and beyond.</p>
              </div>
            )}
            {currentTab === 'rules' && (
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Rules</h2>
                <p className="text-gray-600">{rules.description || 'No rules data available.'}</p>
              </div>
            )}
            {currentTab === 'payouts' && (
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Payouts</h2>
                {payouts.length > 0 ? (
                  <table className="w-full mb-4 border-collapse">
                    <thead>
                      <tr className="bg-gray-200">
                        <th className="border p-2">Category</th>
                        <th className="border p-2">Percentage</th>
                        <th className="border p-2">Prize ($)</th>
                      </tr>
                    </thead>
                    <tbody>
                      {payouts.map((payout, index) => (
                        <tr key={index} className="hover:bg-gray-100">
                          <td className="border p-2">{payout.category}</td>
                          <td className="border p-2">{(payout.percentage * 100).toFixed(2)}%</td>
                          <td className="border p-2">{payout.prize}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                ) : (
                  <p className="text-gray-600">No payouts data available.</p>
                )}
              </div>
            )}
            {currentTab === 'keepers' && (
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Keepers</h2>
                <div className="flex space-x-4 mb-4">
                  {['2022', '2023', '2024', '2025'].map(year => (
                    <button
                      key={year}
                      className={`px-4 py-2 rounded ${selectedYear === year ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'}`}
                      onClick={() => setSelectedYear(year)}
                    >
                      {year}
                    </button>
                  ))}
                </div>
                {keepers[selectedYear].length > 0 ? (
                  <table className="w-full mb-4 border-collapse">
                    <thead>
                      <tr className="bg-gray-200">
                        <th className="border p-2">Team</th>
                        <th className="border p-2">Keeper #1</th>
                        <th className="border p-2">Draft Cost</th>
                        <th className="border p-2">Tag</th>
                        <th className="border p-2">Cost</th>
                        <th className="border p-2">Keeper #2</th>
                        <th className="border p-2">Draft Cost</th>
                        <th className="border p-2">Tag</th>
                        <th className="border p-2">Cost</th>
                        <th className="border p-2">Remaining</th>
                        <th className="border p-2">Paid</th>
                      </tr>
                    </thead>
                    <tbody>
                      {keepers[selectedYear].map((keeper, index) => (
                        <tr key={index} className="hover:bg-gray-100">
                          <td className="border p-2">{keeper.team}</td>
                          <td className="border p-2">{keeper.keeper1}</td>
                          <td className="border p-2">{keeper.draftCost1}</td>
                          <td className="border p-2">{keeper.tag1 ? 'Yes' : 'No'}</td>
                          <td className="border p-2">{keeper.cost1.toFixed(1)}</td>
                          <td className="border p-2">{keeper.keeper2}</td>
                          <td className="border p-2">{keeper.draftCost2}</td>
                          <td className="border p-2">{keeper.tag2 ? 'Yes' : 'No'}</td>
                          <td className="border p-2">{keeper.cost2.toFixed(1)}</td>
                          <td className="border p-2">{keeper.remaining.toFixed(1)}</td>
                          <td className="border p-2">{keeper.paid}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                ) : (
                  <p className="text-gray-600">No keepers for {selectedYear}.</p>
                )}
              </div>
            )}
            {currentTab === 'prizes' && (
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Prizes</h2>
                <div className="flex space-x-4 mb-4">
                  {['2023', '2024', '2025'].map(year => (
                    <button
                      key={year}
                      className={`px-4 py-2 rounded ${selectedYear === year ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'}`}
                      onClick={() => setSelectedYear(year)}
                    >
                      {year}
                    </button>
                  ))}
                </div>
                <h3 className="text-xl font-semibold text-gray-800 mb-2">Weekly High Scores</h3>
                {prizes[selectedYear].weeklyHighScores.length > 0 ? (
                  <table className="w-full mb-4 border-collapse">
                    <thead>
                      <tr className="bg-gray-200">
                        <th className="border p-2">Week</th>
                        <th className="border p-2">Team</th>
                        <th className="border p-2">Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      {prizes[selectedYear].weeklyHighScores.map((score, index) => (
                        <tr key={index} className="hover:bg-gray-100">
                          <td className="border p-2">{score.week}</td>
                          <td className="border p-2">{score.team}</td>
                          <td className="border p-2">{score.total}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                ) : (
                  <p className="text-gray-600">No Weekly High Scores for {selectedYear}.</p>
                )}
                <h3 className="text-xl font-semibold text-gray-800 mb-2">Survivor</h3>
                {prizes[selectedYear].survivor.length > 0 ? (
                  <table className="w-full mb-4 border-collapse">
                    <thead>
                      <tr className="bg-gray-200">
                        <th className="border p-2">Week</th>
                        <th className="border p-2">Eliminated</th>
                      </tr>
                    </thead>
                    <tbody>
                      {prizes[selectedYear].survivor.map((entry, index) => (
                        <tr key={index} className="hover:bg-gray-100">
                          <td className="border p-2">{entry.week || (entry.winner && 'Winner')}</td>
                          <td className="border p-2">{entry.eliminated || entry.winner}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                ) : (
                  <p className="text-gray-600">No Survivor data for {selectedYear}.</p>
                )}
              </div>
            )}
            {currentTab === 'admin' && (
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Admin</h2>
                {!isAdminAuthenticated ? (
                  <div className="max-w-md mx-auto">
                    <h3 className="text-lg font-semibold text-gray-800 mb-2">Admin Login</h3>
                    <form onSubmit={handleAdminLogin} className="space-y-4">
                      <input
                        type="password"
                        value={adminPassword}
                        onChange={(e) => setAdminPassword(e.target.value)}
                        placeholder="Enter admin password"
                        className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                      />
                      <button type="submit" className="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        Login
                      </button>
                    </form>
                  </div>
                ) : (
                  <div className="space-y-8">
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800 mb-2">Add Keeper (2025)</h3>
                      <form onSubmit={handleAddKeeper} className="space-y-4 max-w-md">
                        <input
                          type="text"
                          name="team"
                          placeholder="Team"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                          required
                        />
                        <input
                          type="text"
                          name="keeper1"
                          placeholder="Keeper #1"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                        />
                        <input
                          type="number"
                          name="draftCost1"
                          placeholder="Draft Cost #1"
                          step="0.1"
                          min="0"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                        />
                        <label className="flex items-center space-x-2">
                          <input type="checkbox" name="tag1" className="h-4 w-4" />
                          <span>Tag #1</span>
                        </label>
                        <input
                          type="text"
                          name="keeper2"
                          placeholder="Keeper #2"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                        />
                        <input
                          type="number"
                          name="draftCost2"
                          placeholder="Draft Cost #2"
                          step="0.1"
                          min="0"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                        />
                        <label className="flex items-center space-x-2">
                          <input type="checkbox" name="tag2" className="h-4 w-4" />
                          <span>Tag #2</span>
                        </label>
                        <button type="submit" className="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                          Add Keeper
                        </button>
                      </form>
                    </div>
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800 mb-2">Add Weekly High Score (2025)</h3>
                      <form onSubmit={handleAddWeeklyScore} className="space-y-4 max-w-md">
                        <input
                          type="number"
                          name="week"
                          placeholder="Week (1-14)"
                          min="1"
                          max="14"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                          required
                        />
                        <input
                          type="text"
                          name="team"
                          placeholder="Team"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                          required
                        />
                        <input
                          type="number"
                          name="total"
                          placeholder="Total Score"
                          step="0.01"
                          min="0"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                          required
                        />
                        <button type="submit" className="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                          Add Score
                        </button>
                      </form>
                    </div>
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800 mb-2">Add Survivor Entry (2025)</h3>
                      <form onSubmit={handleAddSurvivor} className="space-y-4 max-w-md">
                        <input
                          type="number"
                          name="week"
                          placeholder="Week (1-12, leave blank for Winner)"
                          min="1"
                          max="12"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                        />
                        <select
                          name="type"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                          required
                        >
                          <option value="eliminated">Eliminated</option>
                          <option value="winner">Winner</option>
                        </select>
                        <input
                          type="text"
                          name="team"
                          placeholder="Team"
                          className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                          required
                        />
                        <button type="submit" className="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                          Add Survivor Entry
                        </button>
                      </form>
                    </div>
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>